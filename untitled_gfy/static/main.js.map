{"version":3,"sources":["../dist/main.js"],"names":[],"mappings":";;;;IAAM,C;;;;AAKN,EAAE,YAAM;AACJ,QAAI,WAAW,EAAf;;AAEA,QAAI,eAAe,SAAS,cAAT,CAAwB,eAAxB,CAAnB;;AAEA,aAAS,WAAT,GAAuB;AACnB,YAAI,aAAa,UAAb,CAAwB,MAAxB,IAAkC,CAAtC,EAAyC;AACrC,yBAAa,WAAb,CAAyB,aAAa,UAAb,CAAwB,CAAxB,CAAzB;AACH;;AAED,YAAI,SAAS,MAAT,IAAmB,CAAvB,EAA0B;AACtB;AACH,SAFD,MAEO;AACH,gBAAI,WAAW,SAAS,KAAT,EAAf;AACA,yBAAa,WAAb,CAAyB,QAAzB;AACA,qBAAS,IAAT;AACH;AACJ;;AAED,QAAI,UAAU,KAAd;;AAEA,aAAS,YAAT,CAAsB,GAAtB,EAA2B;AACvB,YAAI,QAAQ,SAAS,aAAT,CAAuB,OAAvB,CAAZ;AACA,iBAAS,IAAT,CAAc,KAAd;;AAEA,YAAI,SAAS,SAAS,aAAT,CAAuB,QAAvB,CAAb;AACA,eAAO,GAAP,GAAa,GAAb;AACA,eAAO,IAAP,GAAc,WAAd;AACA,cAAM,WAAN,CAAkB,MAAlB;AACA,cAAM,kBAAN,GAA2B,KAA3B;;AAEA,cAAM,MAAN,GAAe,UAAC,CAAD,EAAO;AAClB,sBAAU,IAAV;AACH,SAFD;;AAIA,cAAM,OAAN,GAAgB,UAAC,CAAD,EAAO;AACnB,sBAAU,KAAV;AACH,SAFD;;AAIA,cAAM,UAAN,GAAmB,UAAC,CAAD,EAAO;AACtB,gBAAI,QAAQ,EAAE,MAAd;AACA,gBAAI,CAAC,MAAM,kBAAP,IAA6B,MAAM,QAAN,CAAe,MAAf,GAAwB,CAArD,IAA0D,MAAM,QAAN,CAAe,GAAf,CAAmB,CAAnB,KAAyB,MAAM,QAA7F,EAAuG;AACnG;AACA,sBAAM,kBAAN,GAA2B,IAA3B;AACA;AACH;;AAED,gBAAI,MAAM,QAAN,CAAe,MAAf,IAAyB,CAA7B,EAAgC;AAC5B;AACH,aAFD,MAEO;AACH;AACH;AACJ,SAbD;;AAeA,cAAM,gBAAN,GAAyB,UAAC,CAAD,EAAO;AAC5B;AACH,SAFD;AAGH;;AAED,QAAI,OAAO,KAAX;AACA,aAAS,OAAT,GAAmB;AACf,YAAI,CAAC,IAAL,EAAW;AACP,mBAAO,IAAP;AACA,cAAE,GAAF,CAAM,SAAN,EAAiB,UAAC,GAAD,EAAS;AACtB,wBAAQ,GAAR,CAAY,GAAZ;AACA,6BAAa,GAAb;AACA,uBAAO,KAAP;AACH,aAJD;AAKH;AACJ;;AAGD,gBAAY,YAAM;AACd,YAAI,aAAa,UAAb,CAAwB,MAAxB,IAAkC,CAAlC,IAAuC,CAAC,OAA5C,EAAqD;AACjD;AACH;AACJ,KAJD,EAIG,EAJH;;AAMA,aAAS,gBAAT,CAA0B,OAA1B,EAAmC,UAAC,CAAD,EAAO;AACtC,YAAI,EAAE,OAAF,IAAa,EAAjB,EAAqB;AACjB;AACA,cAAE,cAAF;AACH;AACJ,KALD;;AAOA,aAAS,gBAAT,CAA0B,UAA1B,EAAsC,UAAC,CAAD,EAAO;AAC1C;AACF,KAFD;AAGH,CAxFD","file":"main.js","sourcesContent":["class A {\r\n\r\n\r\n}\r\n\r\n$(() => {\r\n    let playlist = [];\r\n\r\n    let videoWrapper = document.getElementById('video_wrapper');\r\n\r\n    function switchVideo() {\r\n        if (videoWrapper.childNodes.length != 0) {\r\n            videoWrapper.removeChild(videoWrapper.childNodes[0]);\r\n        }\r\n\r\n        if (playlist.length == 0) {\r\n            preload();\r\n        } else {\r\n            let newVideo = playlist.shift();\r\n            videoWrapper.appendChild(newVideo);\r\n            newVideo.play();\r\n        }\r\n    }\r\n\r\n    let playing = false;\r\n\r\n    function preloadVideo(url) {\r\n        let video = document.createElement('video');\r\n        playlist.push(video);\r\n\r\n        let source = document.createElement('source');\r\n        source.src = url;\r\n        source.type = 'video/mp4';\r\n        video.appendChild(source);\r\n        video.markedAsDownloaded = false;\r\n\r\n        video.onplay = (e) => {\r\n            playing = true;\r\n        };\r\n\r\n        video.onended = (e) => {\r\n            playing = false;\r\n        };\r\n\r\n        video.onprogress = (e) => {\r\n            let video = e.target;\r\n            if (!video.markedAsDownloaded && video.buffered.length > 0 && video.buffered.end(0) == video.duration) {\r\n                //console.log('finished loading video...');\r\n                video.markedAsDownloaded = true;\r\n                preload();\r\n            }\r\n\r\n            if (video.buffered.length != 0) {\r\n                //console.log('onprogress', video.buffered.end(0), video.duration);\r\n            } else {\r\n                //console.log('onprogress');\r\n            }\r\n        };\r\n\r\n        video.oncanplaythrough = (e) => {\r\n            //console.log('oncanplaythrough');\r\n        };\r\n    }\r\n\r\n    let lock = false;\r\n    function preload() {\r\n        if (!lock) {\r\n            lock = true;\r\n            $.get('/random', (url) => {\r\n                console.log(url);\r\n                preloadVideo(url);\r\n                lock = false;\r\n            });\r\n        }\r\n    }\r\n\r\n\r\n    setInterval(() => {\r\n        if (videoWrapper.childNodes.length == 0 || !playing) {\r\n            switchVideo();\r\n        }\r\n    }, 10);\r\n\r\n    document.addEventListener('keyup', (e) => {\r\n        if (e.keyCode == 32) {\r\n            switchVideo();\r\n            e.preventDefault();\r\n        }\r\n    });\r\n\r\n    document.addEventListener('dblclick', (e) => {\r\n       switchVideo();\r\n    });\r\n});"]}